(function(b){var o=/\:([\w\.]+)/g,p=/^(?:&[^=]+=[^&]*)+/,t=function(a){var c=[];j(a,function(d,e){if(d==="className")d="class";e&&c.push(q(d),'="',q(e),'" ')});return c.join("")},q=function(a){return a.replace(/"/g,"&#34;").replace(/'/g,"&#39;")},u=function(a,c){for(var d=0,e=0;e<a.names.length;e++){if(!c.hasOwnProperty(a.names[e]))return-1;d++}return d},r=true,k=window.location,v=encodeURIComponent,w=decodeURIComponent,j=b.each,l=b.extend;b.route=function(a,c){var d=[],e=a.replace(o,function(f,h){d.push(h);
return"([^\\/\\&]*)"});b.route.routes[a]={test:new RegExp("^"+e+"($|&)"),route:a,names:d,defaults:c||{},length:a.split("/").length};return b.route};l(b.route,{param:function(a){var c,d=0,e,f=a.route;delete a.route;f&&(c=b.route.routes[f])||j(b.route.routes,function(m,i){e=u(i,a);if(e>d){c=i;d=e}});if(c){var h=l({},a);f=c.route.replace(o,function(m,i){delete h[i];return a[i]===c.defaults[i]?"":v(a[i])});var g;j(c.defaults,function(m,i){h[m]===i&&delete h[m]});g=b.param(h);return f+(g?"&"+g:"")}return b.isEmptyObject(a)?
"":"&"+b.param(a)},deparam:function(a){var c={length:-1};j(b.route.routes,function(h,g){if(g.test.test(a)&&g.length>c.length)c=g});if(c.length>-1){var d=a.match(c.test),e=d.shift(),f=(e=a.substr(e.length-(d[d.length-1]==="&"?1:0)))&&p.test(e)?b.String.deparam(e.slice(1)):{};f=l(true,{},c.defaults,f);j(d,function(h,g){if(g&&g!=="&")f[c.names[h]]=w(g)});f.route=c.route;return f}if(a.charAt(0)!=="&")a="&"+a;return p.test(a)?b.String.deparam(a.slice(1)):{}},data:new b.Observe({}),routes:{},ready:function(a){if(a===
false)r=false;if(a===true||r===true)s();return b.route},url:function(a,c){return c?"#!"+b.route.param(l({},n,a)):"#!"+b.route.param(a)},link:function(a,c,d,e){return"<a "+t(l({href:b.route.url(c,e)},d))+">"+a+"</a>"},current:function(a){return k.hash=="#!"+b.route.param(a)}});b(function(){b.route.ready()});j(["bind","unbind","delegate","undelegate","attr","attrs","serialize","removeAttr"],function(a,c){b.route[c]=function(){return b.route.data[c].apply(b.route.data,arguments)}});var n,s=function(){var a=
k.hash.substr(1,1)==="!"?k.hash.slice(2):k.hash.slice(1);n=b.route.deparam(a);b.route.attrs(n,true)};b(window).bind("hashchange",s);b.route.bind("change",function(a){var c;return function(){var d=arguments,e=this;clearTimeout(c);c=setTimeout(function(){a.apply(e,d)},1)}}(function(){k.hash="#!"+b.route.param(b.route.serialize())}))})(jQuery);
